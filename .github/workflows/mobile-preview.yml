name: Mobile Preview

on:
  push:
    paths:
      - 'apps/mobile/**'
  pull_request:
    paths:
      - 'apps/mobile/**'

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install dependencies
        run: npm ci
        working-directory: apps/mobile
      - uses: expo/expo-github-action@v8
        with:
          expo-token: ${{ secrets.EXPO_TOKEN }}
      - name: Publish to Expo
        run: |
          npx expo publish --non-interactive --json
          echo "Project page: https://expo.dev/@${{ github.actor }}/astro-crm-mini-mobile"
        working-directory: apps/mobile
